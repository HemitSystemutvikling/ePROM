<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Integrasjonsguide for skjemautfyller API | ePROM v11.0</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Integrasjonsguide for skjemautfyller API" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/IntegrasjonsguideSkjemautfyllerApi.html" />
<meta property="og:url" content="http://localhost:4000/IntegrasjonsguideSkjemautfyllerApi.html" />
<meta property="og:site_name" content="ePROM v11.0" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Integrasjonsguide for skjemautfyller API" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Integrasjonsguide for skjemautfyller API","url":"http://localhost:4000/IntegrasjonsguideSkjemautfyllerApi.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=ab89dff6da65ec38e4b1c7a32b73307963685df2">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Integrasjonsguide for skjemautfyller API</h1>
      <h2 class="project-tagline"></h2>
      
        <a href="https://github.com/HemitSystemutvikling/ePROM" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      
<h1 id="integrasjonsguide-for-skjemautfyller-api">Integrasjonsguide for skjemautfyller API</h1>

<p><em>Sist oppdatert 23.09.2019</em></p>

<h3 id="innholdsfortegnelse">Innholdsfortegnelse</h3>

<p><a href="#generelt">GENERELT</a></p>

<p><a href="#handlinger">HANDLINGER</a></p>

<p><a href="#autentisering">Autentisering</a></p>

<p><a href="#hent-skjemabestillinger-for-skjematype">Hent skjemabestillinger for skjematype</a></p>

<p><a href="#hent-skjemabestilling">Hent skjemabestilling</a></p>

<p><a href="#lever-skjema">Lever skjema</a></p>

<p><a href="#feilsituasjoner">Feilsituasjoner</a></p>

<h1 id="generelt">GENERELT</h1>
<p>API’et er laget for å gi mulighet for bruke ePROM med 3dje-parts skjemautfyllere.</p>

<h1 id="handlinger">HANDLINGER</h1>
<p>API’et tilbyr metoder for å hente ut alle skjemabestillinger av en gitt skjematype, hente ut data fra metadatafeltet til en gitt skjemabestilling og levere skjema.
Alle URL’ene som er oppgitt i dette dokumentet går mot integrasjonsmiljøet for ePROM</p>

<h2 id="autentisering">Autentisering</h2>
<p>API’et er beskyttet av OpenID Connect med hybrid-flyt slik at brukere kan holde på en pålogging over lengre tid, noe som feks er tilfelle når en mobil-app skal koble mot API’et. Oppsett av klient som skal benytte APIet gjøres i HelseId admin-grensesnitt for aktuelle miljø. HelseId test ligger her: https://helseid-admin.test.nhn.no/home</p>

<p>Eksempel (C#)</p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// create a redirect URI using an available port on the loopback address.</span>
<span class="c1">// requires the OP to allow random ports on 127.0.0.1 - otherwise set a static port</span>
<span class="kt">var</span> <span class="n">browser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SystemBrowser</span><span class="p">(</span><span class="m">7014</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">redirectUri</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">$"http://127.0.0.1:</span><span class="p">{</span><span class="n">browser</span><span class="p">.</span><span class="n">Port</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OidcClientOptions</span>
<span class="p">{</span>
    <span class="n">Authority</span> <span class="p">=</span> <span class="s">"https://helseid-sts.test.nhn.no/"</span><span class="p">,</span>
    <span class="n">ClientId</span> <span class="p">=</span> <span class="s">"no.hemit.promstestclient-dev"</span><span class="p">,</span>
    <span class="n">ClientSecret</span> <span class="p">=</span> <span class="s">"426VsgzIbW8jpf4ha4cj8V2nTW9W8oKHUORlBvPrF1EFv4R8byJYvri1XXKG1R7T"</span><span class="p">,</span>
    <span class="n">RedirectUri</span> <span class="p">=</span> <span class="n">redirectUri</span><span class="p">,</span>
    <span class="n">Scope</span> <span class="p">=</span> <span class="s">"openid profile helseid://scopes/identity/pid helseid://scopes/identity/security_level hemit:eprom.public.api/*"</span><span class="p">,</span>
    <span class="n">FilterClaims</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="n">Browser</span> <span class="p">=</span> <span class="n">browser</span><span class="p">,</span>
    <span class="n">Flow</span> <span class="p">=</span> <span class="n">OidcClientOptions</span><span class="p">.</span><span class="n">AuthenticationFlow</span><span class="p">.</span><span class="n">Hybrid</span>
<span class="p">};</span>

<span class="kt">var</span> <span class="n">oidcClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OidcClient</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>

<span class="c1">// Log in to get access token</span>
<span class="kt">var</span> <span class="n">loginResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">oidcClient</span><span class="p">.</span><span class="nf">LoginAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">LoginRequest</span><span class="p">());</span>
<span class="kt">var</span> <span class="n">currentAccessToken</span> <span class="p">=</span> <span class="n">loginResult</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">;</span>

<span class="c1">// Create API client</span>
<span class="kt">var</span> <span class="n">epromApiClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
<span class="n">epromApiClient</span><span class="p">.</span><span class="nf">SetBearerToken</span><span class="p">(</span><span class="n">currentAccessToken</span><span class="p">)</span>

<span class="c1">// Call API using the client</span>
<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">epromApiClient</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(...);</span>
</code></pre></div></div>

<h2 id="hent-skjemabestillinger-for-skjematype">Hent skjemabestillinger for skjematype</h2>
<p>Ved å sende med skjematypens FormId filtrerer man skjemabestillingene for den innloggede personen slik at FormOrderId til denne personens skjemabestillinger av gitte type blir hentet ut. API’et tilbyr ikke å hente ut alle skjemabestillinger for en person uavhengig av skjematypen.</p>

<p>API kall, GET request:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;API_ROOT&gt;/api/formorders?formId=&lt;FormId&gt;
</code></pre></div></div>

<p>Returnerer liste med skjemabestillinger:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;FormOrderId1&gt;, &lt;FormOrderId2&gt;, &lt;FormOrderId3&gt;, ...]
</code></pre></div></div>

<h3 id="feilkoder">Feilkoder</h3>
<p>400 BadRequest - FormId er ikke angitt</p>

<h2 id="hent-skjemabestillingens-metadata">Hent skjemabestillingens metadata</h2>
<p>Ved å sende med skjemabestillingens FormOrderId kan man hente ut Metadata angitt i skjemabestillingen.</p>

<p>API kall, GET request:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;API_ROOT&gt;/api/formorders/&lt;FormOrderId&gt;
</code></pre></div></div>

<p>Returnerer skjema metadata:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "morgendose": 1,
    "kveldsdose": 5,
    "...": "..."
}
</code></pre></div></div>

<h3 id="feilkoder-1">Feilkoder</h3>
<p>404 NotFound - finner ikke skjemabestilling med angitt FormOrderId</p>

<h2 id="lever-skjema">Lever skjema</h2>
<p>Utfyllt skjema for en skjemabestillingen leveres ved å sende med skjemabestillingens id (FormOrderId) og skjemaets data.</p>

<p>API kall, PUT request:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;API_ROOT&gt;/api/formorders/&lt;FormOrderId&gt;
</code></pre></div></div>

<p>Data som skal levereres sendes med i body:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "vekt": 70,
    "kommentar": "En liten kommentar fra pasienten",
    "...": "..."
}
</code></pre></div></div>

<p>Returnerer status på levering:
200 OK hvis leveringen gikk om den skulle</p>

<h3 id="feilkoder-2">Feilkoder</h3>
<p>404 NotFound - finner ikke skjemabestilling med angitt FormOrderId
502 BadGateway - problemer ved levering av skjemadata videre til intern ePROM</p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/HemitSystemutvikling/ePROM">ePROM</a> is maintained by <a href="https://github.com/HemitSystemutvikling">HemitSystemutvikling</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>

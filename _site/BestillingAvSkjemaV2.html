<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>BESTILLING AV SKJEMA V2 | ePROM v11.0</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="BESTILLING AV SKJEMA V2" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/BestillingAvSkjemaV2.html" />
<meta property="og:url" content="http://localhost:4000/BestillingAvSkjemaV2.html" />
<meta property="og:site_name" content="ePROM v11.0" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="BESTILLING AV SKJEMA V2" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"BESTILLING AV SKJEMA V2","url":"http://localhost:4000/BestillingAvSkjemaV2.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=ab89dff6da65ec38e4b1c7a32b73307963685df2">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">BESTILLING AV SKJEMA V2</h1>
      <h2 class="project-tagline"></h2>
      
        <a href="https://github.com/HemitSystemutvikling/ePROM" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="bestilling-av-skjema-v2">BESTILLING AV SKJEMA V2</h1>

<p><em>Sist oppdatert 19.04.2023</em></p>

<h2 id="innholdsfortegnelse">Innholdsfortegnelse</h2>

<p><a href="#bestilling-klient-side">Bestilling klient-side</a></p>

<p><a href="#bestilling-server-side">Bestilling server-side</a></p>

<p><a href="#feilsituasjoner">Feilsituasjoner</a></p>

<p><a href="#mottak-av-status-for-bestillingen">Mottak av status for bestillingen</a></p>

<p>API-kallet for bestilling av skjema er i v2 endret slik at man får respons med en gang, uten å vente på at bestillingen har gått igjennom til Helsenorge/Digipost. Når bestillingen er fullført (pasienten har fått beskjed og skjemaet ligger klart til utfylling) vil ePROM gjøre et kall mot Bestillersystemet med status for bestillingen. Bestillersystemet må implementere en service som mottar dette kallet.</p>

<p>Bestilling av skjema kan gjøres både fra server-side og fra klient-side. Ved kall fra server-side kan man benytte seg av et API utviklet av Hemit og distribuert som NuGet pakke for å forenkle oppkoblingen.
Alle URL’ene som er oppgitt i dette dokumentet går mot integrasjonsmiljøet for ePROM</p>

<p>NB!
I verson v2 av API’et skal ApiKey sendes som en <code class="language-plaintext highlighter-rouge">Authorization</code> parameter som del av HTTP header:
<code class="language-plaintext highlighter-rouge">headers: {"Authorization": "Basic " + apiKey}</code></p>

<h2 id="bestilling-klient-side">Bestilling klient-side</h2>

<p><strong>Eksempelkode (javascript)</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">placeFormOrderV2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://proms.hemitdev.org/promswebapi/api/v2/formorder</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// Demo server</span>
    <span class="kd">var</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span> <span class="c1">// The ApiKey for your system</span>
    <span class="kd">var</span> <span class="nx">formId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1bc5f9f0-2607-49eb-94f0-6af955bbd79a</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// RAND-12</span>
    <span class="kd">var</span> <span class="nx">nationalId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">26073941651</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// the national ID of the patient (Norsk fødselsnummer or D-nummer)</span>
    <span class="kd">var</span> <span class="nx">expiryDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">86400000</span> <span class="o">*</span> <span class="mi">7</span><span class="p">));</span> <span class="c1">// add 7 days</span>
    <span class="kd">var</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="na">age</span><span class="p">:</span> <span class="mi">76</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">dontStoreCompletedFormInPha</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">distributionRule</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Basic</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">mustBeSigned</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">signingText</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">physicalAddress</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">testMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">onBehalfOfNationalId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">Authorization</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Basic </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">apiKey</span>
        <span class="p">},</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
            <span class="nx">formId</span><span class="p">,</span>
            <span class="nx">nationalId</span><span class="p">,</span>
            <span class="nx">expiryDate</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="nx">metadata</span><span class="p">,</span>
            <span class="nx">dontStoreCompletedFormInPha</span><span class="p">,</span>
            <span class="nx">distributionRule</span><span class="p">,</span>
            <span class="nx">mustBeSigned</span><span class="p">,</span>
            <span class="nx">signingText</span><span class="p">,</span>
            <span class="nx">physicalAddress</span><span class="p">,</span>
            <span class="nx">testMode</span><span class="p">,</span>
            <span class="nx">onBehalfOfNationalId</span>
        <span class="p">}),</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">formOrderId: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\n</span><span class="s2">singleUseCode: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">singleUseCode</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\n</span><span class="s2">loginUrl: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">loginUrl</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\n</span><span class="s2">preferred notificationChannel: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">notificationChannel</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error!</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>URL for Web API kall</strong></p>

<p>[https://proms.hemitdev.org/promswebapi/api/v2/formorder]</p>

<p><strong>Parametere - Inn</strong></p>

<ul>
  <li>apiKey - ApiKey of the end user system placing the order (sendes som <code class="language-plaintext highlighter-rouge">Authorization</code> parameter som del av HTTP header)</li>
  <li>formId - The form to place an order for</li>
  <li>nationalId  - The national id number of the patient the ordered form is addressing (must be either Norsk fødselsnummer or D-nummer)</li>
  <li>expiryDate - The expiry date of the order</li>
  <li>reminderDate - Optional. Reminderdate is ignored as helsenorge does not use it.</li>
  <li>metadata - Optional. Metadata to send with the order. Pass metadata, like the patient age, as a parameter to this method using an stringified JSON object (ex. JSON.stringify({ age: 76 }))</li>
  <li>dontStoreCompletedFormInPha - Optional. If true, the completed form will not be stored in the patients “Personlig helsearkiv” (Helsenorge) or sent to secure digital mailbox. Default: false</li>
  <li>distributionRule - Optional. The rule used when deciding how to notify the patient <code class="language-plaintext highlighter-rouge">{ Basic | AllowUnsecure | NoDistribution | BasicOrPaper | AllowUnsecureOrPaper | PaperOnly | HelsenorgeOnly | DigitalMailboxOnly | UnsecureOnly }</code> . Tallverdien kan sendes. Default: Basic</li>
  <li>mustBeSigned - Optional. Whether the form must be signed</li>
  <li>signingText - Optional. The text displyed for signing</li>
  <li>physicalAddress - Optional. The address to use when sending to physical mailbox. If none is supplied, the address registered in Folkeregisteret is used. PhysicalAddress is a JSON object in the following format:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    fullName: "Test Testesen",
    addressLine1: "Testeveien 1",
    postalCode: "1234",
    postalPlace: "Testestad"
}
</code></pre></div></div>

<ul>
  <li>testMode - Optional. Set to true when the order is created from ePROM Admin and the form answer shall not to be returned to the BestillerSystem. Default: false</li>
  <li>onBehalfOfNationalId - Optional. The national id number of the citizen the form order is regarding.
Should only be supplied when the recipient of the form order is someone else than the person the form order is regarding. Ex. when the recipient is the parent of the patient the form order is regarding.<br />
If the person identified by onBehalfOfNationalId can be represented on Helsenorge, the form will be sent to that person instead.<br />
<strong>VIKTIG! Se også <a href="PaVegneAvFlyt">“På vegne av”-funksjonalitet og personvern</a> og <a href="RepresentasjonPaaHelsenorge">Representasjon/”På vegne av” på helsenorge</a></strong></li>
</ul>

<p><strong>Parametere – Ut</strong></p>

<p>I tillegg til alle inn-parametre:</p>

<ul>
  <li>id – The id of this form order</li>
  <li>singleUseCode – A code linked to this form order that the patient can use in combination with his date of birth to log in to PROMS to fill out the ordered form. This parameter only has a value when distributionRule is NoDistribution</li>
  <li>loginUrl – URL the patient can use to log in to PROMS to fill out the ordered form</li>
  <li>notificationChannel – The preferred channel used to notify the patient about the form order <code class="language-plaintext highlighter-rouge">{ None | Helsenorge | DigitalMailbox | Unsecure | PhysicalMailbox }</code> . The actual channel used is first known when PROMS performs the callback, notifying about the status.</li>
</ul>

<p><strong>Metode</strong></p>

<p>POST</p>

<h2 id="bestilling-server-side">Bestilling server-side</h2>

<p><strong>API</strong></p>

<p>Tilgjenglig som NuGet pakke</p>

<p><a href="https://pkgs.dev.azure.com/hemit/a7f87e1f-3406-4ac2-a2d4-18e789c37706/_packaging/Hemit_public_packages/nuget/v3/index.json">NuGet repository</a></p>

<p>Navn: Hemit.ePROM.Integration</p>

<p><strong>Eksempelkode (C#)</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">JsonResult</span><span class="p">&gt;</span> <span class="nf">OrderPromsFormV2Async</span><span class="p">(</span><span class="n">Guid</span> <span class="n">formId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">form</span> <span class="p">=</span> <span class="n">_context</span><span class="p">.</span><span class="n">FormService</span><span class="p">.</span><span class="nf">GetForm</span><span class="p">(</span><span class="n">formId</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">patient</span> <span class="p">=</span> <span class="n">_context</span><span class="p">.</span><span class="n">PatientInRegistryService</span><span class="p">.</span><span class="nf">GetByFormGuid</span><span class="p">(</span><span class="n">formId</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">promsFormId</span> <span class="p">=</span> <span class="n">_formTypeToPromsFormIdMapping</span><span class="p">[(</span><span class="n">FormType</span><span class="p">)</span> <span class="n">form</span><span class="p">.</span><span class="n">FormTypeId</span><span class="p">];</span>

    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Api</span><span class="p">.</span><span class="nf">CreateFormOrderV2Async</span><span class="p">(</span>
        <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"PromsApiBaseUrl"</span><span class="p">],</span>
        <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"PromsApiKey"</span><span class="p">],</span>
        <span class="n">promsFormId</span><span class="p">,</span>
        <span class="n">patient</span><span class="p">.</span><span class="n">DecryptedPID</span><span class="p">,</span>
        <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="m">7</span><span class="p">),</span>
        <span class="k">null</span><span class="p">,</span>
        <span class="nf">GetMetadata</span><span class="p">(</span><span class="n">promsFormId</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">patient</span><span class="p">)</span> <span class="k">false</span><span class="p">,</span>
        <span class="n">DistributionRule</span><span class="p">.</span><span class="n">AllowUnsecure</span><span class="p">,</span>
        <span class="k">false</span><span class="p">,</span>
        <span class="k">null</span><span class="p">,</span>
        <span class="k">null</span><span class="p">,</span>
        <span class="k">false</span><span class="p">,</span>
        <span class="k">null</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">HasErrors</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">ErrorStatusCode</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
        <span class="n">Response</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">ErrorJson</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">_promsFormOrderService</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">form</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">form</span><span class="p">.</span><span class="n">ReshId</span><span class="p">);</span>

    <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span>
        <span class="n">loginUrl</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">LoginUrl</span><span class="p">,</span>
        <span class="n">singleUseCode</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SingleUseCode</span><span class="p">,</span>
        <span class="n">notificationChannel</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">NotificationChannel</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Parametere - Inn</strong></p>

<ul>
  <li>promsApiBaseUrl - The base URL of the PROMS API</li>
  <li>apiKey - ApiKey of the end user system placing the order (sendes som <code class="language-plaintext highlighter-rouge">Authorization</code> parameter som del av HTTP header)</li>
  <li>formId - The form to place an order for</li>
  <li>nationalId - The national id number of the patient the ordered form is addressing (must be either Norsk fødselsnummer or D-nummer)</li>
  <li>expiryDate - The expiry date of the order</li>
  <li>reminderDate - Reminderdate is ignored as helsenorge does not use it.</li>
  <li>metadata - Optional. Metadata to send with the order. Pass metadata, like the patient age, as a parameter to this method using an anonymous object (ex.new { age = 23 }).</li>
  <li>dontStoreCompletedFormInPha - Optional. If true, the completed form will not be stored in the patients “Personlig helsearkiv” (Helsenorge) or sent to secure digital mailbox. Default: false</li>
  <li>distributionRule - Optional. The rule used when deciding how to notify the patient <code class="language-plaintext highlighter-rouge">{ Basic | AllowUnsecure | NoDistribution | BasicOrPaper | AllowUnsecureOrPaper | PaperOnly | HelsenorgeOnly | DigitalMailboxOnly | UnsecureOnly }</code> . Tallverdien kan sendes. Default: Basic</li>
  <li>mustBeSigned - Optional. Whether the form must be signed</li>
  <li>signingText - Optional. The text displyed for signing</li>
  <li>physicalAddress - Optional. The address to use when sending to physical mailbox. If none is supplied, the address registered in Folkeregisteret is used</li>
  <li>testMode - Optional. Set to true when the order is created from ePROM Admin and the form answer shall not to be returned to the BestillerSystem. Default: false</li>
  <li>onBehalfOfNationalId - Optional. The national id number of the citizen the form order is regarding.
    <ul>
      <li>Skal kun bli tilordnet når mottaker er en annen enn personen skjemaet gjelder. F.eks når mottaker er foresatt/verge for personen skjemaet gjelder for.</li>
      <li>“På vegne av” funksjonalitet er ikke lenger aktiv mot helsenorge.<br />
Hvis det kommer en <a href="../BestillingAvSkjemaV2">bestilling av skjema med “På vegne av” (tilordnet onBehalfOfNationalId)</a> vil skjema bli sendt til onBehalfOfNationalId hvis denne personen kan representeres på Helsenorge. Hvis personen ikke kan kontaktes på helsenorge vil <a href="PaVegneAvFlyt">vanlig “På vegne av” rutine</a> følges mot de andre distribueringskanalene.</li>
      <li>Se også <a href="PaVegneAvFlyt">“På vegne av”-funksjonalitet og personvern</a></li>
    </ul>
  </li>
</ul>

<p>promsApiBaseUrl skal være https://proms.hemitdev.org/promswebapi</p>

<p><strong>Parametere – Ut</strong></p>

<ul>
  <li>ResponseWrapper&lt;CreateFormOrderV2Response&gt;
    <ul>
      <li>HasErrors</li>
      <li>ErrorStatusCode</li>
      <li>ErrorJson</li>
      <li>Data
        <ul>
          <li>Id – The id of this form order</li>
          <li>SingleUseCode – A code linked to this form order that the patient can use in combination with his date of birth to log in to PROMS to fill out the ordered form. This parameter only has a value when distributionRule is NoDistribution</li>
          <li>LoginUrl – URL the patient can use to log in to PROMS to fill out the ordered form</li>
          <li>NotificationChannel – The channel used to notify the patient about the form order <code class="language-plaintext highlighter-rouge">{ None | Helsenorge | DigitalMailbox | Unsecure | PhysicalMailbox }</code> . The actual channel used is first known when PROMS performs the callback, notifying about the status.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="feilsituasjoner">Feilsituasjoner</h2>

<p>Hvis responsen resulterer i “id”: “00000000-0000-0000-0000-000000000000” er det ikke generert noe bestilling. Dette skjer hvis fødselsnummeret ikke eksisterer.
Ellers kan følgende feilsituasjoner oppstå:</p>

<ul>
  <li>BadRequest(“The ordered form is not Published”)</li>
  <li>BadRequest($”No form with id=’{formOrder.formId}’ exists”)</li>
  <li>BadRequest($”The ordered form needs to be signed. This is not possible when using DistributionRule = ‘NoDistribution’.”)</li>
  <li>BadRequest($”The ordered form needs to be signed. This is not possible when the form is ordered on behalf of someone.”)</li>
  <li>BadRequest($”Form with id=’{formOrder.formId}’ is not paper enabled”)</li>
  <li>BadRequest($”JSON in metadata is not valid: {ex.Message}”)</li>
  <li>BadRequest($”nationalId: FH-nummer is not supported as national ID. The national ID must be either Norsk fødselsnummer or D-nummer.”)</li>
  <li>BadRequest($”nationalId: H-nummer is not supported as national ID. The national ID must be either Norsk fødselsnummer or D-nummer.”)</li>
</ul>

<h2 id="mottak-av-status-for-bestillingen">Mottak av status for bestillingen</h2>

<p>API-kallet for bestilling av skjema er i v2 endret slik at man får respons med en gang, uten å vente på at bestillingen har gått igjennom til Helsenorge/Digipost. Når bestillingen er fullført (pasienten har fått beskjed og skjemaet ligger klart til utfylling) vil ePROM gjøre et kall mot Bestillersystemet med status for bestillingen. Bestillersystemet må implementere en service som mottar dette kallet.</p>

<p><strong>URL for Web API kall</strong></p>

<p>ApiBaseUrl for web API registreres i ePROM Selvbetjeningsmodul under Bestillersystem: <a href="https://proms.hemitdev.org/PromsAdministration/">https://proms.hemitdev.org/PromsAdministration/</a></p>

<p>Web API må være tilgjenglig på URL: https:// <code class="language-plaintext highlighter-rouge">&lt;ApiBaseUrl&gt;</code> /api/PromsFormOrder</p>

<p>F.eks: [https://mrsweb.hemit.org/PromsTestregisterServices/api/PromsFormOrder/]</p>

<p><strong>Parametere - Inn</strong></p>

<ul>
  <li>apiKey – ApiKey of the end user system placing the order</li>
  <li>formOrderId – The Id of the formOrder</li>
  <li>notificationChannel – The actual channel used to notify the patient about the form order <code class="language-plaintext highlighter-rouge">{ None | Helsenorge | DigitalMailbox | Unsecure | PhysicalMailbox }</code></li>
  <li>timestamp - Timestamp when order was initiated</li>
  <li>timestampUtc - Timestamp when order was initiated in UTC format</li>
  <li>formOrderStatus – Status of the formOrder
    <ul>
      <li>Ordered – The formOrder was successful</li>
      <li>Error – The formOrder was not successfull. For time being, the only reason for this is when the patient cannot be notified because there is no way to make contact.</li>
    </ul>
  </li>
  <li>formOrderStatusErrorCode – ErrorCode of the formOrder
    <ul>
      <li>None – No error code</li>
      <li>PatientUnreachable - Unable to notify the pasient bye the selected notification channel.</li>
    </ul>
  </li>
</ul>

<p><strong>Parametere - Ut</strong></p>

<ul>
  <li>success – true if the request was processed successfully, otherwise false</li>
</ul>

<p>For parameter inn og ut kan NuGet pakken <em>Hemit.ePROM.Integration</em> benyttes. Bruk da <em>Hemit.ePROM.Integration.PromsFormOrderRequest</em> for parameter inn og <em>Hemit.ePROM.Integration.PromsFormOrderResponse</em> for parameter ut</p>

<p><strong>Metode</strong></p>

<p>PUT</p>

<p>Eksempel request fra Proms (JSON)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "apiKey" : "",
    "formOrderId" : "184738d0-3c39-e611-9c2a-34e6d72e03c7",
    "notificationChannel" : "Helsenorge",
    "timestamp" : "2023-03-29T10:20:10.1804332",
    "timestampUtc" : "2023-03-29T08:20:10.1804332Z",
    "formOrderStatus" : "Ordered",
    "formOrderStatusErrorCode" : "None"
}
{
    "apiKey" : "",
    "formOrderId" : "184738d0-3c39-e611-9c2a-34e6d72e03c7",
    "notificationChannel" : "None",
    "formOrderStatus" : "Error",
    "formOrderStatusErrorCode" : "PatientUnreachable"
}
</code></pre></div></div>

<p>Eksempel response (JSON)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "success" : true
}
{
    "success" : false
}
</code></pre></div></div>

<p><a href="./">Tilbake</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/HemitSystemutvikling/ePROM">ePROM</a> is maintained by <a href="https://github.com/HemitSystemutvikling">HemitSystemutvikling</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
